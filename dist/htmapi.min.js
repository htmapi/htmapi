/*!
 * htmapi v0.0.1 (https://github.com/htmapi/htmapi)
 * Copyright (c) 2024 Anton Maklakov
 * Licensed under MIT (https://github.com/htmapi/blob/main/LICENSE)
*/ 
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Htmapi=e.Htmapi||t()}("undefined"!=typeof self?self:this,function(){return function(){"use strict";let e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>"[object Function]"===Object.prototype.toString.call(e),o=e=>{throw Error(e)},l=e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e,r="TEMPLATE",n="data-",i=`${n}cample`,s=`${n}src`,d=`${n}method`,a=`${n}status`,h=`${n}after`,u=`${n}mode`,p=()=>document,c=e=>{"string"!=typeof e&&o("Bad response");let t=new DOMParser().parseFromString(`<template>${e}</template>`,"text/html"),l=t.childNodes[0].childNodes[0].firstChild,r=l.content,n=r.querySelectorAll("script");for(let i=0;i<n.length;i++){let s=n[i];r.removeChild(s)}return l},f=(t,l,r,n,i,s)=>{let{mode:d,cache:h,redirect:u,get:p,referrerPolicy:f,credentials:m,timeout:g,headers:$,requestBody:v}=i,y={method:r.toUpperCase()};if(void 0!==m&&(y.credentials=m),void 0!==v&&(y.body=v),void 0!==d&&(y.mode=d),void 0!==h&&(y.cache=h),void 0!==u&&(y.redirect=u),void 0!==f&&(y.referrerPolicy=f),$){if(e($)){let N=new Headers;for(let E in $){let[w,b]=E;if("string"==typeof b)try{N.set(w,b)}catch(T){throw T}else o("Header has no string value")}y.headers=N}else o('The "header" property does not have a value object')}g&&(y.signal=AbortSignal.timeout(g));let A=void 0!==s,C=e=>{s.status!==e&&(s.status=e,p?.("status",e))},L=e=>{e?t.setAttribute(a,e):t.removeAttribute(a)};A?C(0):L("loading"),fetch(n,y).then(e=>(A?C(e.status):L(),e.ok||o(`Request error with code ${e.status}`),e.text())).then(e=>{let o=c(e);if(A)s.element=o,p?.("element",o);else{let r=o.content.childNodes;if(l){if(l.nodes){let n=[],i=l.nodes.length;for(let d=0;d<i;d++){let a=l.nodes[d];if(d===i-1)for(let h=0;h<r.length;h++){let u=r[h],f=l.parentNode.insertBefore(u,a);n.push(f)}l.parentNode.removeChild(a)}l.nodes=n}else{let m=t.parentNode,g=[];for(let $=0;$<r.length;$++){let v=r[$],y=m.insertBefore(v,t);g.push(y)}m.removeChild(t),l.nodes=g,l.parentNode=m}}else{let N=t.parentNode;for(let E=0;E<r.length;E++){let w=r[E];N.insertBefore(w,t)}N.removeChild(t)}}}).catch(e=>{throw e})},m=(e,t,r)=>{let n=e.getAttribute(s);if(n){let i=(e.getAttribute(d)||"GET").toLowerCase();if(l(i))o(`${d} has only GET, POST, PUT, PATCH or DELETE values`);else{let a=e.getAttribute(h),c=e.getAttribute(u),m=(c||"all").toLowerCase();"one"!==m&&"all"!==m&&o(`${u} has only ONE or ALL values`);let g="all"===m,$;g&&a&&($={nodes:null,parentNode:null});let v=r?(e,t)=>f(void 0,void 0,i,n,e,t):()=>{f(e,$,i,n,{})},y=v;if(a){let N=(e,t,o,l)=>{let r=p().querySelectorAll(t),n=g?()=>{v(o,l)}:()=>{v(o,l);for(let t=0;t<r.length;t++){let i=r[t];i.removeEventListener(e,n)}};for(let i=0;i<r.length;i++){let s=r[i];s.addEventListener(e,n)}};if(a.indexOf(":")>0){let E=a.split(":"),w=E[0],b=E.slice(1).join(":");y=(e,t)=>{N(w,b,e,t)}}else o(`${h} attribute doesn't work without EventTargets`)}else c&&o(`${u} attribute doesn't work without ${h}`);return t(y)}}else o('The "source" attribute are not found or empty')},g=e=>{"string"!=typeof e&&o("template was not found or the type of the passed value is not string");let l=(e=>{let t=new DOMParser().parseFromString(`<template>${e}</template>`,"text/html"),l=t.childNodes[0].childNodes[0].firstChild;l.content.children.length>1&&o("Template include only one node with type 'Element'");let n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent)){e.remove();return}}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(l.content.childNodes[0]);let s=l.content.firstElementChild;return(s?.nodeName!==r||null===s.getAttribute(i))&&o(`Other nodes, except those with the name "${r}" and attribute "${i}", are not yet supported`),s})(e),n=e=>{let l=(l={})=>{let r={element:void 0,status:0};return l.get&&!t(l.get)&&o("The get property has a function value"),e(l,r),r};return l};return m(l,n,!0)},$=()=>{let e=p().querySelectorAll(`[${i}]`);for(let t=0;t<e.length;t++){let l=e[t];null===l.parentNode&&o('"parentNode" is null'),l.nodeName!==r&&o(`Other nodes, except those with the name "${r}", are not yet supported`);let n=e=>{e()};m(l,n)}};return"loading"===p().readyState?p().addEventListener("DOMContentLoaded",$):$(),{createTemplate:g}}()});